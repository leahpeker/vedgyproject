{% extends "base.html" %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-4">Upgrade to VegListings Pro</h1>
        <p class="text-lg text-gray-600 mb-4">Join our premium community and unlock full access</p>
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto">
            <h3 class="font-semibold text-blue-800 mb-2">üí∞ Sliding Scale Pricing</h3>
            <p class="text-blue-700 text-sm">
                Choose what you pay. Everyone gets the same great features regardless of price tier.
            </p>
        </div>
    </div>
    
    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- $3 Tier -->
        <div class="bg-white rounded-lg shadow-lg overflow-hidden border border-gray-200">
            <div class="bg-gray-600 text-white p-4 text-center">
                <div class="text-3xl font-bold mb-1">$3<span class="text-sm">/month</span></div>
                <p class="text-gray-200 text-sm">Perfect for students and low income friends</p>
            </div>
            <div class="p-4">
                <button onclick="selectPlan(3)" class="w-full bg-gray-600 text-white py-2 px-4 rounded hover:bg-gray-700 transition-colors">
                    Select
                </button>
            </div>
        </div>
        
        <!-- $8 Tier -->
        <div class="bg-white rounded-lg shadow-lg overflow-hidden border-2 border-green-500">
            <div class="bg-green-600 text-white p-4 text-center">
                <div class="text-3xl font-bold mb-1">$5<span class="text-sm">/month</span></div>
                <p class="text-green-200 text-sm">If you can afford a little more </p>
            </div>
            <div class="p-4">
                <button onclick="selectPlan(5)" class="w-full bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition-colors">
                    Select
                </button>
            </div>
        </div>
        
        <!-- $15 Tier -->
        <div class="bg-white rounded-lg shadow-lg overflow-hidden border border-gray-200">
            <div class="bg-purple-600 text-white p-4 text-center">
                <div class="text-3xl font-bold mb-1">$10<span class="text-sm">/month</span></div>
                <p class="text-purple-200 text-sm">Support the platform and help us grow</p>
            </div>
            <div class="p-4">
                <button onclick="selectPlan(10)" class="w-full bg-purple-600 text-white py-2 px-4 rounded hover:bg-purple-700 transition-colors">
                    Select
                </button>
            </div>
        </div>
        
        <!-- Custom Tier -->
        <div class="bg-white rounded-lg shadow-lg overflow-hidden border border-gray-200">
            <div class="bg-orange-600 text-white p-4 text-center">
                <div class="text-2xl font-bold mb-1">$<input type="number" id="custom-amount" min="3" max="100" value="10" class="w-12 bg-transparent border-b border-orange-300 text-center text-white placeholder-orange-200" style="color: white;"><span class="text-sm">/month</span></div>
                <p class="text-orange-200 text-sm">Want to keep us going? If you have the means, pay as much as you want!</p>
            </div>
            <div class="p-4">
                <button onclick="selectCustomPlan()" class="w-full bg-orange-600 text-white py-2 px-4 rounded hover:bg-orange-700 transition-colors">
                    Select
                </button>
            </div>
        </div>
    </div>
    
    <div class="bg-white rounded-lg shadow-lg overflow-hidden mb-8">
        <div class="bg-gray-50 border-b p-4">
            <h2 class="text-xl font-semibold text-center">All tiers include the same great features:</h2>
        </div>
        
        <div class="p-6">
            <h3 class="text-lg font-semibold mb-4">What's included:</h3>
            <ul class="space-y-3 mb-6">
                <li class="flex items-center">
                    <svg class="w-5 h-5 text-green-600 mr-3" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Post unlimited housing listings
                </li>
                <li class="flex items-center">
                    <svg class="w-5 h-5 text-green-600 mr-3" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Priority support from our team
                </li>
                <li class="flex items-center">
                    <svg class="w-5 h-5 text-green-600 mr-3" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Access to vegan housing community
                </li>
                <li class="flex items-center">
                    <svg class="w-5 h-5 text-green-600 mr-3" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    No ads or spam - quality connections only
                </li>
                <li class="flex items-center">
                    <svg class="w-5 h-5 text-green-600 mr-3" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Cancel anytime, no strings attached
                </li>
            </ul>
            
            <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                <h4 class="font-semibold text-green-800 mb-2">üå± Supporting Vegan Community</h4>
                <p class="text-green-700 text-sm">
                    Your membership helps us maintain a spam-free platform dedicated to connecting vegans with like-minded roommates and renters.
                </p>
            </div>
            
            <button onclick="startCheckout()" class="w-full bg-green-600 text-white py-3 px-6 rounded-lg text-lg font-semibold hover:bg-green-700 transition-colors">
                Start Monthly Membership
            </button>
            
            <p class="text-center text-sm text-gray-500 mt-4">
                Secure payment processed by Paddle. Cancel anytime from your account settings.
            </p>
        </div>
    </div>
    
    <div class="text-center">
        <a href="/listings" class="text-green-600 hover:text-green-800">‚Üê Back to listings</a>
    </div>
</div>

<script>
let selectedAmount = null;

function selectPlan(amount) {
    selectedAmount = amount;
    // Update button states
    updateButtonStates();
    // Scroll to checkout button
    document.querySelector('button[onclick="startCheckout()"]').scrollIntoView({ behavior: 'smooth' });
}

function selectCustomPlan() {
    const customAmount = document.getElementById('custom-amount').value;
    selectedAmount = parseInt(customAmount);
    if (selectedAmount < 3) {
        alert('Minimum amount is $3/month');
        return;
    }
    // Update button states
    updateButtonStates();
    // Scroll to checkout button
    document.querySelector('button[onclick="startCheckout()"]').scrollIntoView({ behavior: 'smooth' });
}

function updateButtonStates() {
    // Reset all buttons
    const buttons = document.querySelectorAll('button[onclick^="selectPlan"], button[onclick="selectCustomPlan()"]');
    buttons.forEach(btn => {
        btn.classList.remove('ring-2', 'ring-blue-500');
        btn.classList.add('hover:opacity-90');
    });
    
    // Highlight selected button
    if (selectedAmount === 3) {
        document.querySelector('button[onclick="selectPlan(3)"]').classList.add('ring-2', 'ring-blue-500');
    } else if (selectedAmount === 5) {
        document.querySelector('button[onclick="selectPlan(5)"]').classList.add('ring-2', 'ring-blue-500');
    } else if (selectedAmount === 10) {
        document.querySelector('button[onclick="selectPlan(10)"]').classList.add('ring-2', 'ring-blue-500');
    } else if (selectedAmount && selectedAmount >= 3) {
        document.querySelector('button[onclick="selectCustomPlan()"]').classList.add('ring-2', 'ring-blue-500');
    }
    
    // Update checkout button text
    const checkoutBtn = document.querySelector('button[onclick="startCheckout()"]');
    if (selectedAmount) {
        checkoutBtn.textContent = `Start $${selectedAmount}/month Membership`;
        checkoutBtn.disabled = false;
        checkoutBtn.classList.remove('opacity-50', 'cursor-not-allowed');
    } else {
        checkoutBtn.textContent = 'Choose a plan above';
        checkoutBtn.disabled = true;
        checkoutBtn.classList.add('opacity-50', 'cursor-not-allowed');
    }
}

function startCheckout() {
    if (!selectedAmount) {
        alert('Please select a pricing tier first');
        return;
    }
    
    // For development - this would integrate with Paddle.js
    // In production, this would open Paddle's checkout overlay with the selected amount
    alert(`Paddle checkout would open here for $${selectedAmount}/month. For development, this simulates a successful payment.`);
    
    // For demo purposes, let's simulate a successful subscription
    if (confirm(`Simulate successful subscription for $${selectedAmount}/month?`)) {
        simulateSuccessfulSubscription();
    }
}

function simulateSuccessfulSubscription() {
    // This is just for development/testing
    fetch('/paddle/webhook', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            'event_type': 'subscription_created',
            'customer_email': '{{ user.email }}',
            'subscription_id': 'sub_demo_' + Date.now(),
            'customer_id': 'cus_demo_' + Date.now(),
            'amount': selectedAmount
        })
    })
    .then(() => {
        alert('Demo subscription activated! Refresh the page to see changes.');
        window.location.reload();
    });
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    updateButtonStates();
});
</script>
{% endblock %}